<link rel="stylesheet" href="../base.css">

<style>
  body {
    width: 100%;
    height: 100%;
  }
  
  #wrapper {
    position: relative;
    aspect-ratio: 0.95;
    min-width: 0%;
    max-width: 100%;
    min-height: 0%;
    max-height: 100%;
    margin: 0 auto;
  }

  h1 {
    text-align: center;
    margin: 0;
  }

  canvas {
    width: 100%;
    /* height: 100%; */
  }

  #ui {
    display: flex;
    gap: 3vmin;
  }

  .playerName {
    font-weight: bold;
    margin-right: 1vmin;
  }

</style>

<body>
  <div id="wrapper">
    <!-- <h1>Pente</h1> -->
    <div id="ui"></div>
    <canvas id="canvas"></canvas>
  </div>
</body>

<script type="module">
  import { PenteCanvas } from '../src/PenteCanvas.js';
  import { Piece } from '../src/Piece.js';

  const pente = new PenteCanvas( document.getElementById( 'canvas' ), onUIUpdate );

  const ui = document.getElementById( 'ui' );

  const playerDiv = [];
  const captureUI = [];

  for ( let team = 1; team <= pente.board.teams; team ++ ) {
    const div = document.createElement( 'div' );

    const playerName = document.createElement( 'span' );
    playerName.className = 'playerName';
    playerName.innerText = `Player ${ team }`;

    const colorDropdown = document.createElement( 'select' );

    for ( const colorName in Piece.PlayerColors ) {
      const option = document.createElement( 'option' );
      option.value = Piece.PlayerColors[ colorName ];
      option.innerText = colorName;
      if ( option.value == Piece.TeamColor[ team - 1 ] ) {
        option.selected = true;
      }
      colorDropdown.appendChild( option );
    }

    colorDropdown.addEventListener( 'change', ( e ) => {
      Piece.TeamColor[ team - 1 ] = e.currentTarget.value;
      pente.redraw();
    } );

    const aiDropdown = document.createElement( 'select' );

    [ 'Human', 'AI' ].forEach( ( label, index ) => {
      const option = document.createElement( 'option' );
      option.value = index;
      option.innerText = label;
      if ( option.value == pente.board.ai[ team - 1 ] ) {
        option.selected = true;
      }
      aiDropdown.appendChild( option );
    } );

    aiDropdown.addEventListener( 'change', ( e ) => {
      pente.board.ai[ team - 1 ] = parseInt( e.currentTarget.value );
    } );

    const span = document.createElement( 'span' );
    span.id = `capture${ team }`;
    span.textContent = 0;
    
    const label = document.createElement( 'label' );
    label.textContent = 'Captures: ';
    label.htmlFor = span.id;

    playerDiv.push( div );
    captureUI.push( span );

    div.appendChild( playerName );
    div.appendChild( colorDropdown );
    div.appendChild( aiDropdown );
    div.appendChild( label );
    div.appendChild( span );

    ui.appendChild( div );
  }

  const playersLabel = document.createElement( 'label' );
  playersLabel.innerText= 'Players: ';
  playersLabel.htmlFor = 'numPlayers';

  const playersDropdown = document.createElement( 'select' );
  playersDropdown.id = 'numPlayers';

  [ 2, 3, 4 ].forEach( ( number ) => {
    const option = document.createElement( 'option' );
    option.value = number;
    option.innerText = number;
    playersDropdown.appendChild( option );
  } );

  ui.appendChild( playersLabel );
  ui.appendChild( playersDropdown );

  const newButton = document.createElement( 'button' );
  newButton.innerText = 'New';
  newButton.addEventListener( 'click', _ => pente.newGame() );
  ui.appendChild( newButton );

  const undoButton = document.createElement( 'button' );
  undoButton.innerText = 'Undo';
  undoButton.addEventListener( 'click', _ => pente.undo() );
  ui.appendChild( undoButton );

  function onUIUpdate( board ) {
    board.captures.forEach( ( number, index ) => {
      captureUI[ index ].innerText = number;

      playerDiv[ index ].style.backgroundColor = board.currentTeam - 1 == index ? Piece.TeamColor[ index ] : 'black';
    } );
  }

  

  const wrapper = document.getElementById( 'wrapper' );
  window.onresize = ( e ) => {
    pente.updateSize();
  };
  window.onresize();

  

</script>